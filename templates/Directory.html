<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GMC Directory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{{url_for('static', filename='css/bootstrap.min.css')}}" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        #property-search-input {
            /* This gives the search input a specific, wider width. */
            /* You can adjust the pixel value to your liking. */
            /* width: 400px; */

            /* --- ALTERNATIVE RESPONSIVE OPTION --- */
            /* Uncomment the line below and comment out the line above */
            /* to make the search bar 30% of the viewport width. */
            width: 30vw;
        }
    </style>
</head>

<header>
    <div class="navbar-header">
        <a class="navbar-brand" href="/">
            <img style="max-width:120px; margin-top: -7px;" src="{{ url_for('static', filename='images/gateway management company logo.png') }}">
        </a>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="search" id="property-search-input" placeholder='Search... Property Name OR by columnName(e.g., State:AL Regional:"John Doe")' aria-label="Search">
        </div>
      </div>
    </nav>
</header>

<div class="container-fluid" style="min-height:100%; width:80%">
    <body>
        <div role="tabpanel">
            <ul class="nav nav-tabs nav justify-content-center" role="tablist">
              <li role="presentation" class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#Properties" aria-controls="Properties" role="tab">Properties</a>
              </li>
              <li role="presentation" class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#Corporate" aria-controls="Corporate" role="tab">Corporate</a>
              </li>
            </ul>

            <div class="tab-content">
              <div role="tabpanel" class="tab-pane active" id="Properties">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Property Name</th>
                      <th scope="col">Phone Number</th>
                    </tr>
                  </thead>
                  <tbody id="property-table-body">
                    {% for row in DirectoryTable %}
                    <tr>
                        <th scope="row">{{loop.index}}</th>
                        <td><a href="#" data-toggle="modal" data-target='#{{row.PROPERTYNAME.replace(" ", "").replace(".", "").replace("&", "").replace(",", "").replace("(", "").replace(")", "")}}' class="btn btn-success">{{row.PROPERTYNAME}}</a></td>
                        <div class="modal fade" id="{{row.PROPERTYNAME.replace(' ', '').replace('.','').replace('&', '').replace(',', '').replace('(', '').replace(')', '')}}" role="dialog" aria-labelledby="myModalLabel">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h4 class="modal-title">{{row.PROPERTYNAME}}</h4>
                                </div>
                                <div class="modal-body">
                                    <p>Manager: {{row.MANAGERNAME}}</p>
                                    <p>Assistant: {{row.ASSISTANTNAME}}</p>
                                    <p>Regional: {{row.REGIONAL}}</p>
                                    <p>Street Address: {{row.STREETNAME}}</p>
                                    <p>City: {{row.CITY}}</p>
                                    <p>State: {{row.STATE}}</p>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                              </div>
                            </div>
                        </div>
                        <td>{{row.PHONENUMBER}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <div role="tabpanel" class="tab-pane" id="Corporate">Corporate</div>
            </div>
        </div>
    </body>
</div>

<script>
$(document).ready(function(){
    $('#property-search-input').on('keyup', function(){
        let searchTerm = $(this).val();

        $.ajax({
            url: '/live_search',
            method: 'GET',
            data: { query: searchTerm },
            success: function(data){
                let tableBody = $('#property-table-body');
                tableBody.empty();

                if (data.length === 0) {
                    tableBody.append('<tr><td colspan="3" class="text-center">No properties found.</td></tr>');
                } else {
                    $.each(data, function(index, row){

                        let modalId = row.PROPERTYNAME.replace(/[^a-zA-Z0-9]/g, '');

                        let newRowHtml = `
                            <tr>
                                <th scope="row">${index + 1}</th>
                                <td>
                                    <a href="#" data-toggle="modal" data-target='#${modalId}' class="btn btn-success">${row.PROPERTYNAME}</a>
                                    <div class="modal fade" id="${modalId}" role="dialog" aria-labelledby="myModalLabel">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title">${row.PROPERTYNAME}</h4>
                                                </div>
                                                <div class="modal-body">
                                                    <p>Manager: ${row.MANAGERNAME || 'N/A'}</p>
                                                    <p>Assistant: ${row.ASSISTANTNAME || 'N/A'}</p>
                                                    <p>Regional: ${row.REGIONAL || 'N/A'}</p>
                                                    <p>Street Address: ${row.STREETNAME || 'N/A'}</p>
                                                    <p>City: ${row.CITY || 'N/A'}</p>
                                                    <p>State: ${row.STATE || 'N/A'}</p>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>${row.PHONENUMBER || 'N/A'}</td>
                            </tr>
                        `;

                        tableBody.append(newRowHtml);
                    });
                }
            }
        });
    });
});
</script>

</html>